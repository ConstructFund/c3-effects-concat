(function(e){function t(t){for(var a,o,s=t[0],l=t[1],c=t[2],f=0,p=[];f<s.length;f++)o=s[f],Object.prototype.hasOwnProperty.call(r,o)&&r[o]&&p.push(r[o][0]),r[o]=0;for(a in l)Object.prototype.hasOwnProperty.call(l,a)&&(e[a]=l[a]);m&&m(t);while(p.length)p.shift()();return i.push.apply(i,c||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],a=!0,s=1;s<n.length;s++){var l=n[s];0!==r[l]&&(a=!1)}a&&(i.splice(t--,1),e=o(o.s=n[0]))}return e}var a={},r={app:0},i=[];function o(t){if(a[t])return a[t].exports;var n=a[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=a,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)o.d(n,a,function(t){return e[t]}.bind(null,a));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],l=s.push.bind(s);s.push=t,s=s.slice();for(var c=0;c<s.length;c++)t(s[c]);var m=l;i.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"034f":function(e,t,n){"use strict";n("85ec")},"56d7":function(e,t,n){"use strict";n.r(t);var a=n("2b0e"),r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-app",[n("v-main",[n("v-layout",{staticStyle:{margin:"10em"},attrs:{column:"",wrap:""}},[n("v-file-input",{ref:"fileInput",attrs:{multiple:"",chips:"",label:"Add effect addons"},on:{change:e.onFileChange}}),n("draggable",{staticClass:"list-group",attrs:{"ghost-class":"ghost"},model:{value:e.addons,callback:function(t){e.addons=t},expression:"addons"}},[n("transition-group",e._l(e.addons,(function(t){return n("div",{key:t.id,staticClass:"list-group-item"},[e._v(" "+e._s(t.name)+" ")])})),0)],1),n("v-btn",{attrs:{color:"primary",disabled:!e.addons.length},on:{click:e.onGenerate}},[e._v(" Generate ")])],1)],1)],1)},i=[],o=(n("caad"),n("c4e3")),s=n.n(o),l=n("b76a"),c=n.n(l),m=n("21a6"),f={name:"App",components:{draggable:c.a},data:()=>({addons:[],processedEffects:{},commonUniforms:["varying mediump vec2 vTex;","uniform lowp sampler2D samplerFront;","uniform mediump vec2 srcStart;","uniform mediump vec2 srcEnd;","uniform mediump vec2 srcOriginStart;","uniform mediump vec2 srcOriginEnd;","uniform mediump vec2 layoutStart;","uniform mediump vec2 layoutEnd;","uniform lowp sampler2D samplerBack;","uniform lowp sampler2D samplerDepth;","uniform mediump vec2 destStart;","uniform mediump vec2 destEnd;","uniform highp float seconds;","uniform mediump vec2 pixelSize;","uniform mediump float pixelWidth;","uniform mediump float pixelHeight;","uniform mediump float layerScale;","uniform mediump float layerAngle;","uniform mediump float devicePixelRatio;"],commonUniformsToRemove:["varying mediump vec2 vTex;","uniform lowp sampler2D samplerFront;","uniform mediump vec2 srcStart;","uniform mediump vec2 srcEnd;","uniform mediump vec2 srcOriginStart;","uniform mediump vec2 srcOriginEnd;","uniform mediump vec2 layoutStart;","uniform mediump vec2 layoutEnd;","uniform lowp sampler2D samplerBack;","uniform lowp sampler2D samplerDepth;","uniform mediump vec2 destStart;","uniform mediump vec2 destEnd;","uniform highp float seconds;","uniform mediump vec2 pixelSize;","uniform mediump float pixelWidth;","uniform mediump float pixelHeight;","uniform lowp float pixelWidth;","uniform lowp float pixelHeight;","uniform mediump float layerScale;","uniform mediump float layerAngle;","uniform mediump float devicePixelRatio;"]}),methods:{onFileChange(e){Promise.all(e.map(e=>{let t=new s.a,n={name:e.name,data:null,id:"",fx:null,lang:null},a=0;return t.loadAsync(e.arrayBuffer()).then(async e=>{let t=[];if(e.forEach(r=>{r.includes("MACOSX")||(r.endsWith("addon.json")?(t.push(e.file(r).async("string").then(e=>{let t=e.replaceAll(/\ufeff/g,"");n.data=JSON.parse(t),n.id=n.data.id,n.name=n.data.name})),a++):r.endsWith("effect.fx")?(t.push(e.file(r).async("string").then(e=>{n.fx=e})),a++):r.endsWith("lang/en-US.json")&&(t.push(e.file(r).async("string").then((function(e){let t=e.replaceAll(/\ufeff/g,"");n.lang=JSON.parse(t)}))),a++))}),3===a){await Promise.all(t);let e=this.addons.findIndex(e=>e.id===n.id);-1!==e?this.addons[e]=n:this.addons.push(n)}}).catch(e=>{console.log(e)})})).then(()=>{this.addons.forEach(e=>{this.processEffect(e)})})},onGenerate(){let e=new s.a;e.file("effect.fx",this.concatEffects(this.addons.map(e=>e.id)));let t=this.concatData(this.addons.map(e=>e.id));e.file("addon.json",JSON.stringify(t,null,2)),e.file("lang/en-US.json",JSON.stringify(this.concatLang(this.addons.map(e=>e.id)),null,2)),e.generateAsync({type:"blob"}).then(e=>{Object(m["saveAs"])(e,t.id+".c3Addon")})},processEffect(e){let t=e.id,n=e.data,a=e.lang,r=e.fx,i=this.processedEffects,o=this.commonUniformsToRemove;if(t in i)return;i[t]={};let s=r.split("\n");s=s.map(e=>e.trim().replace(/\/\/.*/,"").trim()),s=s.filter(e=>e.length>0);let l=s.filter(e=>e.startsWith("precision"));l.forEach(e=>{let t=e.split(" "),n=t[1],a=t[2].replace(/;/,""),r=new RegExp("(?<!highp |lowp |mediump )"+a);s=s.map(e=>e.replace(r,`${n} ${a}`))}),s=s.filter(e=>!e.startsWith("precision")),s=s.filter(e=>!o.includes(e)),i[t].uniforms=s.filter(e=>e.startsWith("uniform")),s=s.filter(e=>!e.startsWith("uniform")),i[t].uniforms=i[t].uniforms.map(e=>{let r=e.split(" "),i=r[r.length-1].replace(";",""),o=`${t}_${i}`;e=e.replace(i,o),s=s.map(e=>e.replaceAll(new RegExp(`(?<!\\w)${i}(?!\\w)`,"g"),o));let l=n.parameters.find(e=>e.uniform===i);if(l){let e=a.text.effects[t.toLowerCase()].parameters[l.id];delete a.text.effects[t.toLowerCase()].parameters[l.id],l&&(l.id=`${t}_${l.id}`,l.uniform=o),a.text.effects[t.toLowerCase()].parameters[l.id]=e}else console.log(`${t}_${i} not found in data.json`);return e}),i[t].defines=s.filter(e=>e.startsWith("#define")),i[t].defines=i[t].defines.map(e=>{let n=e.split(" "),a=n[1],r=`${t.toUpperCase()}_${a}`;return e=e.replace(a,r),s=s.map(e=>e.replaceAll(new RegExp(`(?<!\\w)${a}(?!\\w)`,"g"),r)),e}),s=s.filter(e=>!e.startsWith("#define")),i[t].rawCode=s.join("\n");let c={},m="",f=[],p=/^(\w+) +(\w+ +)?(\w+) *\(((\w+ +)?(\w+ +)?(\w+ *),? *)*\) *\{? *$/,d=0,u=!1;s.forEach(e=>{if(u){if(f.push(e),e.includes("}")&&(d--,0===d)){if(u=!1,"main"!==m){let e=`${t}_${m}`;f=f.map(t=>t.replaceAll(m,e)),s=s.map(t=>t.replaceAll(m,e)),c[e]=f}else c["main"]=f;f=[],m=""}e.includes("{")&&d++}u||e.match(p)&&(u=!0,e.match(/\{/g)&&d++,m=e.match(p)[3],f.push(e))}),i[t].functions=c,s=s.filter(e=>!Object.keys(c).some(t=>c[t].some(t=>e===t))),s=s.map(e=>e.trim()),s=s.filter(e=>e.length>0),s.length>0&&console.log(`Warning: ${t} has some code left`)},concatEffects(e){let t=[],n=this.processedEffects,a=this.commonUniforms;t=t.concat(a),t.push(""),e.forEach(e=>{let a=n[e];t=t.concat(a.uniforms),t.push("")}),e.forEach(e=>{let a=n[e];t=t.concat(a.defines),t.push("")}),e.forEach(e=>{let a=n[e];Object.keys(a.functions).forEach(e=>{"main"!==e&&(t=t.concat(a.functions[e]),t.push(""))})});let r=!1,i="";return e.forEach((a,o)=>{let s=n[a];o===e.length-1&&(r=!0);let l=s.functions.main;if(""!==i&&(l=l.map(e=>e.replaceAll("texture2D(samplerFront,",i+"("))),!r){let e=!1;i=a+"_main",l=l.map(t=>t.includes("main")&&!e?t.replaceAll(/void main\([^)]*\)/g,`mediump vec4 ${i}(mediump vec2 vTex)`):t),l=l.map(e=>e.replaceAll(/gl_FragColor *= */g,"return "))}t=t.concat(l),t.push("")}),t.join("\n")},concatData(e){let t={"is-c3-addon":!0,type:"effect",version:"1.0.0.0",website:"https://www.construct.net",documentation:"https://www.construct.net","file-list":["lang/en-US.json","addon.json","effect.fx"]},n=e.map(e=>this.addons.find(t=>t.id===e));return t.name=n.map(e=>e.name).join(" + "),t.id=n.map(e=>e.id).join("_"),t.author=n.map(e=>e.data.author).join(", "),t.description="Concat effect of "+n.map(e=>e.name).join(", "),t.category=n.map(e=>e.data.category).reduce((e,t)=>e===t?e:"other",n[0].data.category),t["blends-background"]=n.map(e=>e.data["blends-background"]).reduce((e,t)=>e||t,n[0].data["blends-background"]),t["cross-sampling"]=n.map(e=>e.data["cross-sampling"]).reduce((e,t)=>e||t,n[0].data["cross-sampling"]),t["preserves-opaqueness"]=n.map(e=>e.data["preserves-opaqueness"]).reduce((e,t)=>e||t,n[0].data["preserves-opaqueness"]),t.animated=n.map(e=>e.animated).reduce((e,t)=>e||t,n[0].animated),t["extend-box"]=n.map(e=>e.data["extend-box"]).reduce((e,t)=>({horizontal:Math.max(e.horizontal,t.horizontal),vertical:Math.max(e.vertical,t.vertical)}),n[0].data["extend-box"]),t.parameters=n.map(e=>e.data.parameters).reduce((e,t)=>e.concat(t),[]),t},concatLang(e){let t={languageTag:"en-US",text:{effects:{}}},n=e.map(e=>this.addons.find(t=>t.id===e)),a=n.map(e=>e.id).join("_");t.text.effects[a.toLowerCase()]={name:n.map(e=>e.lang.text.effects[e.id.toLowerCase()].name).join(" + "),description:"Concat effect of "+n.map(e=>e.name).join(", ")};let r={};return n.forEach(e=>{r={...r,...e.lang.text.effects[e.id.toLowerCase()].parameters}}),t.text.effects[a.toLowerCase()].parameters=r,t}}},p=f,d=(n("034f"),n("2877")),u=n("6544"),h=n.n(u),g=n("7496"),v=n("8336"),w=n("23a7"),y=n("a722"),x=n("f6c4"),b=Object(d["a"])(p,r,i,!1,null,null,null),j=b.exports;h()(b,{VApp:g["a"],VBtn:v["a"],VFileInput:w["a"],VLayout:y["a"],VMain:x["a"]});var E=n("f309");a["a"].use(E["a"]);var S=new E["a"]({});a["a"].config.productionTip=!1,new a["a"]({vuetify:S,render:e=>e(j)}).$mount("#app")},"85ec":function(e,t,n){}});
//# sourceMappingURL=app.cd9ca6ce.js.map